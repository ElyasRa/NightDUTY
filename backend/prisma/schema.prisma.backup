generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  FINANCE
  DISPOSITION
}

enum Weekday {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

enum InvoiceStatus {
  OPEN
  PAID
  CANCELLED
}

model User {
  id            Int      @id @default(autoincrement())
  username      String   @unique
  password_hash String
  role          Role     @default(FINANCE)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Company {
  id            Int             @id @default(autoincrement())
  name          String
  address       String
  hourRate      Decimal         @db.Decimal(10, 2)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  workingHours  WorkingHours[]
  specialHours  SpecialHours[]
  earlySwaps    EarlySwap[]
  reports       Report[]
  invoices      Invoice[]
}

model WorkingHours {
  id        Int      @id @default(autoincrement())
  companyId Int
  weekday   Weekday
  fromTime  DateTime @db.Time()
  toTime    DateTime @db.Time()
  company   Company  @relation(fields: [companyId], references: [id])
}

model SpecialHours {
  id        Int      @id @default(autoincrement())
  companyId Int
  fromDate  DateTime @db.Date
  toDate    DateTime @db.Date
  fromTime  DateTime @db.Time()
  toTime    DateTime @db.Time()
  rate      Decimal  @db.Decimal(10, 2)
  company   Company  @relation(fields: [companyId], references: [id])
}

model EarlySwap {
  id        Int      @id @default(autoincrement())
  companyId Int
  date      DateTime @db.Date
  fromTime  DateTime @db.Time()
  company   Company  @relation(fields: [companyId], references: [id])
}

model Report {
  id          Int      @id @default(autoincrement())
  companyId   Int
  fromDate    DateTime @db.Date
  toDate      DateTime @db.Date
  totalHours  Decimal  @db.Decimal(10, 2)
  pdfPath     String?
  createdAt   DateTime @default(now())
  company     Company  @relation(fields: [companyId], references: [id])
}

model Invoice {
  id        Int           @id @default(autoincrement())
  companyId Int
  date      DateTime      @db.Date
  amount    Decimal       @db.Decimal(10, 2)
  status    InvoiceStatus @default(OPEN)
  pdfPath   String?
  createdAt DateTime      @default(now())
  company   Company       @relation(fields: [companyId], references: [id])
  payment   Payment?
}

model Payment {
  id        Int      @id @default(autoincrement())
  invoiceId Int      @unique
  amount    Decimal  @db.Decimal(10, 2)
  date      DateTime @db.Date
  createdAt DateTime @default(now())
  invoice   Invoice  @relation(fields: [invoiceId], references: [id])
}

model Company {
  id              Int       @id @default(autoincrement())
  name            String    @unique
  contact_person  String?   @map("contact_person")
  email           String?
  phone           String?
  address         String?
  city            String?
  postal_code     String?   @map("postal_code")
  country         String?   @default("Deutschland")
  tax_number      String?   @map("tax_number")
  notes           String?
  is_active       Boolean   @default(true) @map("is_active")
  created_at      DateTime  @default(now()) @map("created_at")
  updated_at      DateTime  @updatedAt @map("updated_at")

  @@map("Company")
}
